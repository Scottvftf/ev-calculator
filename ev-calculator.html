<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0a1628">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="EV Calc">
<meta name="description" content="Simple, instant EV charging calculations. How long to charge, and how much you'll gain.">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<title>EV Calculator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&family=Zen+Dots&display=swap" rel="stylesheet">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     INLINE SVG ICON LIBRARY
     All icons are 20√ó20 viewBox, stroke-based,
     stroke-width 1.5, round caps/joins, no fill
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<svg xmlns="http://www.w3.org/2000/svg" style="display:none">
  <!-- bolt / lightning -->
  <symbol id="ico-bolt" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
    <path d="M11.5 2L4 11h6l-1.5 7 7.5-9h-6l1.5-7z"/>
  </symbol>
  <!-- battery -->
  <symbol id="ico-battery" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
    <rect x="1" y="6" width="15" height="8" rx="1.5"/>
    <path d="M16 9v2" stroke-width="2.5" stroke-linecap="round"/>
    <path d="M4 10h6" stroke-width="1.6"/>
  </symbol>
  <!-- pencil / edit -->
  <symbol id="ico-edit" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
    <path d="M14.5 2.5a1.414 1.414 0 012 2L6 15l-4 1 1-4 11.5-11.5z"/>
  </symbol>
  <!-- clock / timer -->
  <symbol id="ico-clock" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="10" cy="10" r="7.5"/>
    <path d="M10 6v4l2.5 2.5"/>
  </symbol>
  <!-- trending up / gain -->
  <symbol id="ico-trending" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
    <path d="M2 14l5-5 3 3 5-5"/>
    <path d="M13 7h4v4"/>
  </symbol>
  <!-- lightbulb / tip -->
  <symbol id="ico-tip" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M10 2a5.5 5.5 0 014 9.3c-.6.6-1 1.4-1 2.2V14H7v-.5c0-.8-.4-1.6-1-2.2A5.5 5.5 0 0110 2z"/>
    <path d="M7.5 17.5h5M8.5 15.5h3"/>
  </symbol>
  <!-- search -->
  <symbol id="ico-search" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="8.5" cy="8.5" r="5.5"/>
    <path d="M12.5 12.5L17 17"/>
  </symbol>
  <!-- chevron down -->
  <symbol id="ico-chevron" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
    <path d="M5 7.5l5 5 5-5"/>
  </symbol>
  <!-- check / success -->
  <symbol id="ico-check" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 10l4.5 4.5L16 6"/>
  </symbol>
  <!-- arrow right -->
  <symbol id="ico-arrow-right" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 10h12M11 5l5 5-5 5"/>
  </symbol>
  <!-- sparkle / celebrate (replaces üéâ) -->
  <symbol id="ico-sparkle" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M10 2v3M10 15v3M2 10h3M15 10h3M4.2 4.2l2.1 2.1M13.7 13.7l2.1 2.1M4.2 15.8l2.1-2.1M13.7 6.3l2.1-2.1"/>
    <circle cx="10" cy="10" r="2.5"/>
  </symbol>
</svg>

<style>
  :root {
    --bg: #0a1628; --surface: #0f2140; --card: #132850; --border: #1e3a5f;
    --accent: #00e5ff; --accent2: #7fff6e; --accent3: #ff6b35; --accent4: #a855f7;
    --text: #e8f4f8; --muted: #6b8fa8;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Zen Dots',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; overflow-x:hidden; }
  body::before {
    content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
    background: radial-gradient(ellipse at 10% 20%,rgba(0,229,255,.07) 0%,transparent 50%),
                radial-gradient(ellipse at 90% 80%,rgba(127,255,110,.05) 0%,transparent 50%),
                radial-gradient(ellipse at 50% 50%,rgba(168,85,247,.04) 0%,transparent 60%);
  }

  /* ‚îÄ‚îÄ SVG ICON HELPERS ‚îÄ‚îÄ */
  .ico { display:inline-block; vertical-align:middle; flex-shrink:0; }
  .ico svg { display:block; }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ONBOARDING OVERLAY
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #onboarding {
    position:fixed; inset:0; z-index:500; background:var(--bg);
    display:flex; align-items:center; justify-content:center; padding:1.5rem;
    transition:opacity .4s ease;
  }
  #onboarding.hidden { opacity:0; pointer-events:none; }

  .ob-screen { display:none; flex-direction:column; align-items:center; text-align:center; max-width:420px; width:100%; }
  .ob-screen.active { display:flex; }

  /* Welcome bolt icon */
  .ob-bolt-wrap {
    width:80px; height:80px; border-radius:22px;
    background:linear-gradient(135deg,var(--accent),var(--accent4));
    display:flex; align-items:center; justify-content:center;
    margin-bottom:1.4rem;
    animation:pulse 2.5s ease-in-out infinite;
    box-shadow: 0 0 40px rgba(0,229,255,.25);
  }
  @keyframes pulse { 0%,100%{transform:scale(1);box-shadow:0 0 40px rgba(0,229,255,.2)} 50%{transform:scale(1.05);box-shadow:0 0 60px rgba(0,229,255,.35)} }

  /* Ready icon */
  .ob-ready-icon {
    width:72px; height:72px; border-radius:50%;
    background:rgba(127,255,110,.1); border:2px solid rgba(127,255,110,.3);
    display:flex; align-items:center; justify-content:center;
    margin-bottom:1.2rem;
    color:var(--accent2);
  }

  .ob-title { font-size:2.2rem; font-weight:800; line-height:1.1; margin-bottom:.6rem; }
  .ob-title span { color:var(--accent); }
  .ob-sub { font-family:'Lexend',sans-serif; font-size:.9rem; color:var(--muted); line-height:1.7; margin-bottom:2rem; }

  .ob-step-label { font-family:'Lexend',sans-serif; font-size:.6rem; letter-spacing:.15em; text-transform:uppercase; color:var(--muted); margin-bottom:1.2rem; }
  .ob-question { font-size:1.3rem; font-weight:800; line-height:1.2; margin-bottom:.5rem; }
  .ob-hint { font-family:'Lexend',sans-serif; font-size:.82rem; color:var(--muted); line-height:1.7; margin-bottom:1.4rem; }

  .ob-input-wrap { width:100%; position:relative; margin-bottom:.8rem; }
  .ob-input { width:100%; background:var(--surface); border:2px solid var(--border); border-radius:12px; padding:1rem 3.5rem 1rem 1.2rem; color:var(--text); font-family:'Zen Dots',sans-serif; font-size:1.6rem; outline:none; transition:border-color .2s; text-align:center; }
  .ob-input:focus { border-color:var(--accent); }
  .ob-input-unit { position:absolute; right:1rem; top:50%; transform:translateY(-50%); font-family:'Lexend',sans-serif; font-size:.8rem; color:var(--muted); pointer-events:none; }

  .ob-popular-label { font-family:'Lexend',sans-serif; font-size:.62rem; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); margin-bottom:.6rem; }
  .ob-chips { display:flex; gap:.4rem; flex-wrap:wrap; justify-content:center; margin-bottom:1.4rem; }
  .ob-chip { padding:.45rem .85rem; border-radius:20px; font-family:'Lexend',sans-serif; font-size:.68rem; line-height:1.4; cursor:pointer; border:1px solid var(--border); background:transparent; color:var(--muted); transition:all .15s; text-align:center; }
  .ob-chip:hover { color:var(--text); border-color:var(--muted); }
  .ob-chip.active { color:var(--bg); border-color:var(--accent); background:var(--accent); }
  .ob-chip small { display:block; font-size:.58rem; opacity:.8; }

  .ob-dots { display:flex; gap:.5rem; margin-bottom:1.8rem; }
  .ob-dot { width:8px; height:8px; border-radius:50%; background:var(--border); transition:all .3s; }
  .ob-dot.active { background:var(--accent); width:24px; border-radius:4px; }
  .ob-dot.done { background:var(--accent2); }

  .ob-btn { width:100%; padding:1rem; border-radius:12px; border:none; font-family:'Lexend',sans-serif; font-size:.9rem; font-weight:700; cursor:pointer; transition:all .2s; letter-spacing:.04em; display:flex; align-items:center; justify-content:center; gap:.5rem; }
  .ob-btn-primary { background:var(--accent); color:var(--bg); }
  .ob-btn-primary:hover { background:#33eaff; transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,229,255,.3); }
  .ob-btn-primary:disabled { background:var(--border); color:var(--muted); cursor:not-allowed; transform:none; box-shadow:none; }
  .ob-btn-ghost { background:transparent; color:var(--muted); border:1px solid var(--border); margin-top:.6rem; }
  .ob-btn-ghost:hover { color:var(--text); border-color:var(--muted); }

  .ob-summary-card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:1.2rem 1.4rem; width:100%; margin-bottom:1.5rem; text-align:left; }
  .ob-summary-label { font-family:'Lexend',sans-serif; font-size:.58rem; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); margin-bottom:.7rem; }
  .ob-summary-row { display:flex; justify-content:space-between; align-items:center; gap:1rem; }
  .ob-summary-key { font-family:'Lexend',sans-serif; font-size:.8rem; color:var(--muted); display:flex; align-items:center; gap:.5rem; }
  .ob-summary-val { font-size:1.1rem; font-weight:800; color:var(--accent); }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MAIN APP
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #app { opacity:0; transition:opacity .4s ease; pointer-events:none; }
  #app.visible { opacity:1; pointer-events:all; }

  header { position:sticky; top:0; z-index:100; background:rgba(10,22,40,.92); backdrop-filter:blur(20px); border-bottom:1px solid var(--border); padding:0 1rem; }
  .header-inner { display:flex; align-items:center; justify-content:space-between; height:60px; max-width:900px; margin:0 auto; }
  .logo { display:flex; align-items:center; gap:0.6rem; }
  .logo-icon {
    width:32px; height:32px; background:linear-gradient(135deg,var(--accent),var(--accent4));
    border-radius:8px; display:flex; align-items:center; justify-content:center;
    color:#0a1628;
  }
  .logo-text { font-size:1rem; font-weight:800; letter-spacing:-.02em; }
  .logo-text span { color:var(--accent); }

  .header-car {
    font-family:'Lexend',sans-serif; font-size:.72rem; color:var(--muted);
    display:flex; align-items:center; gap:.4rem;
    cursor:pointer; padding:.3rem .65rem; border-radius:6px; border:1px solid var(--border);
    transition:all .2s;
  }
  .header-car:hover { border-color:var(--accent); color:var(--text); }
  .header-car:hover svg { color:var(--accent); }
  .header-car .cap { color:var(--accent); font-weight:700; font-family:'Zen Dots',sans-serif; font-size:.8rem; }
  .header-sep { width:1px; height:12px; background:var(--border); }

  nav { background:var(--surface); border-bottom:1px solid var(--border); position:sticky; top:60px; z-index:99; }
  .nav-inner { display:flex; max-width:900px; margin:0 auto; overflow-x:auto; scrollbar-width:none; }
  .nav-inner::-webkit-scrollbar { display:none; }
  .tab { flex-shrink:0; padding:.85rem 1.2rem; font-family:'Lexend',sans-serif; font-size:.7rem; letter-spacing:.08em; text-transform:uppercase; color:var(--muted); cursor:pointer; border-bottom:2px solid transparent; transition:all .2s; white-space:nowrap; display:flex; align-items:center; gap:.45rem; }
  .tab:hover { color:var(--text); }
  .tab.active { color:var(--accent); border-bottom-color:var(--accent); }
  .tab.active svg { color:var(--accent); }

  main { max-width:900px; margin:0 auto; padding:1.5rem 1rem 4rem; position:relative; z-index:1; }
  .page { display:none; }
  .page.active { display:block; }

  .calc-card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:1.4rem; margin-bottom:1rem; position:relative; overflow:hidden; }
  .calc-card::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:var(--accent); }
  .calc-card.green::before { background:var(--accent2); }

  .result-hero { background:linear-gradient(135deg,rgba(0,229,255,.08),rgba(168,85,247,.05)); border:1px solid rgba(0,229,255,.2); border-radius:12px; padding:1.4rem; text-align:center; margin-bottom:1rem; }
  .result-hero .big-val { font-size:3rem; font-weight:800; color:var(--accent); line-height:1; margin-bottom:.3rem; }
  .result-hero.green { background:linear-gradient(135deg,rgba(127,255,110,.08),rgba(0,229,255,.04)); border-color:rgba(127,255,110,.2); }
  .result-hero.green .big-val { color:var(--accent2); }
  .result-hero .sub-val { font-family:'Lexend',sans-serif; font-size:.8rem; color:var(--muted); }
  .result-hero .breakdown { display:flex; justify-content:center; gap:1.5rem; margin-top:1rem; flex-wrap:wrap; }
  .result-hero .breakdown-item { text-align:center; }
  .result-hero .breakdown-item .val { font-size:1.2rem; font-weight:800; color:var(--accent4); }
  .result-hero .breakdown-item .lbl { font-family:'Lexend',sans-serif; font-size:.6rem; letter-spacing:.08em; text-transform:uppercase; color:var(--muted); margin-top:.2rem; }

  .form-group { margin-bottom:1rem; }
  .form-label { font-family:'Lexend',sans-serif; font-size:.65rem; letter-spacing:.08em; text-transform:uppercase; color:var(--muted); display:block; margin-bottom:.4rem; }
  .form-input { width:100%; background:var(--surface); border:1px solid var(--border); border-radius:8px; padding:.65rem .8rem; color:var(--text); font-family:'Zen Dots',sans-serif; font-size:.9rem; outline:none; transition:border-color .15s; }
  .form-input:focus { border-color:var(--accent); }
  .input-row { display:grid; grid-template-columns:1fr 1fr; gap:.8rem; }
  .section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:.8rem; margin-top:1.5rem; }
  .section-title { font-size:.75rem; font-family:'Lexend',sans-serif; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); }

  .charger-chips { display:flex; gap:.4rem; flex-wrap:wrap; margin-bottom:.8rem; }
  .charger-chip { padding:.35rem .8rem; border-radius:20px; font-family:'Lexend',sans-serif; font-size:.65rem; letter-spacing:.04em; cursor:pointer; border:1px solid var(--border); background:transparent; color:var(--muted); transition:all .15s; white-space:nowrap; }
  .charger-chip:hover { color:var(--text); border-color:var(--muted); }
  .charger-chip.active { color:var(--bg); border-color:var(--accent2); background:var(--accent2); }

  .dual-range { position:relative; height:48px; }
  .dual-range input[type=range] {
    position:absolute; width:100%; height:6px; appearance:none;
    background:transparent; pointer-events:none; top:50%; transform:translateY(-50%); outline:none;
  }
  .dual-range input[type=range]::-webkit-slider-thumb {
    appearance:none; width:22px; height:22px; border-radius:50%;
    background:var(--accent); border:3px solid var(--bg); box-shadow:0 0 0 2px var(--accent);
    pointer-events:all; cursor:grab; transition:transform .15s;
  }
  .dual-range input[type=range]::-webkit-slider-thumb:active { cursor:grabbing; transform:scale(1.2); }
  .dual-range input[type=range]#range-target::-webkit-slider-thumb { background:var(--accent4); box-shadow:0 0 0 2px var(--accent4); }
  .dual-range input[type=range]::-moz-range-thumb {
    width:22px; height:22px; border-radius:50%; background:var(--accent);
    border:3px solid var(--bg); box-shadow:0 0 0 2px var(--accent); pointer-events:all; cursor:grab;
  }
  .dual-range input[type=range]#range-target::-moz-range-thumb { background:var(--accent4); box-shadow:0 0 0 2px var(--accent4); }
  .range-track { position:absolute; height:6px; top:50%; transform:translateY(-50%); left:0; right:0; background:var(--border); border-radius:3px; pointer-events:none; }
  .range-fill { position:absolute; height:6px; background:linear-gradient(90deg,var(--accent),var(--accent4)); border-radius:3px; top:0; }
  .range-labels { display:flex; justify-content:space-between; font-family:'Lexend',sans-serif; font-size:.65rem; color:var(--muted); margin-top:.3rem; }
  .slider-vals { display:flex; justify-content:space-between; margin-bottom:.5rem; }
  .slider-val { font-family:'Lexend',sans-serif; font-size:.75rem; }
  .slider-val .num { font-size:1.2rem; font-weight:700; }
  .slider-val .num.cyan { color:var(--accent); }
  .slider-val .num.purple { color:var(--accent4); }
  .slider-val .lbl { font-size:.6rem; letter-spacing:.06em; text-transform:uppercase; color:var(--muted); }

  .battery-vis { background:var(--surface); border:2px solid var(--border); border-radius:8px; height:28px; position:relative; overflow:hidden; margin-bottom:.6rem; }
  .battery-vis::after { content:''; position:absolute; right:-8px; top:50%; transform:translateY(-50%); width:6px; height:14px; background:var(--border); border-radius:0 3px 3px 0; }
  .battery-current { position:absolute; left:0; top:0; bottom:0; background:rgba(0,229,255,.25); border-right:2px dashed var(--accent); transition:width .3s; }
  .battery-target { position:absolute; left:0; top:0; bottom:0; background:rgba(168,85,247,.25); border-right:2px solid var(--accent4); transition:width .3s; }

  .info-row { display:flex; align-items:center; gap:.6rem; padding:.5rem 0; border-bottom:1px solid rgba(30,58,95,.5); }
  .info-row:last-child { border-bottom:none; }
  .info-row .lbl { font-family:'Lexend',sans-serif; font-size:.72rem; color:var(--muted); flex:1; }
  .info-row .val { font-family:'Lexend',sans-serif; font-size:.8rem; font-weight:700; }

  .tip { background:rgba(168,85,247,.08); border:1px solid rgba(168,85,247,.2); border-radius:8px; padding:.7rem .9rem; font-family:'Lexend',sans-serif; font-size:.72rem; color:var(--muted); line-height:1.6; margin-bottom:1rem; display:flex; gap:.65rem; align-items:flex-start; }
  .tip-icon { flex-shrink:0; color:var(--accent4); margin-top:.05rem; }
  .tip strong { color:var(--accent4); }

  .toast { position:fixed; bottom:2rem; left:50%; transform:translateX(-50%) translateY(20px); background:var(--accent); color:var(--bg); padding:.6rem 1.2rem; border-radius:20px; font-family:'Lexend',sans-serif; font-size:.75rem; font-weight:700; z-index:600; opacity:0; transition:all .3s; white-space:nowrap; pointer-events:none; display:flex; align-items:center; gap:.4rem; }
  .toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

  #edit-modal { position:fixed; inset:0; z-index:400; background:rgba(0,0,0,.7); backdrop-filter:blur(8px); display:none; align-items:flex-end; padding:1rem; }
  #edit-modal.open { display:flex; }
  .edit-modal-card { background:var(--card); border:1px solid var(--border); border-radius:16px 16px 8px 8px; width:100%; max-width:480px; margin:0 auto; padding:1.5rem; animation:slideUp .25s ease; }
  @keyframes slideUp { from{transform:translateY(40px);opacity:0} to{transform:translateY(0);opacity:1} }
  .edit-modal-title { display:flex; align-items:center; gap:.6rem; margin-bottom:.4rem; font-size:1rem; }
  .edit-modal-title svg { color:var(--accent); }
  .edit-modal-card p { font-family:'Lexend',sans-serif; font-size:.75rem; color:var(--muted); margin-bottom:1.2rem; line-height:1.5; }
  .edit-ob-chips { display:flex; gap:.4rem; flex-wrap:wrap; margin-bottom:.8rem; }
  .edit-ob-chip { padding:.35rem .8rem; border-radius:20px; font-family:'Lexend',sans-serif; font-size:.65rem; cursor:pointer; border:1px solid var(--border); background:transparent; color:var(--muted); transition:all .15s; }
  .edit-ob-chip:hover { color:var(--text); border-color:var(--muted); }
  .edit-ob-chip.active { color:var(--bg); border-color:var(--accent); background:var(--accent); }
  .edit-modal-actions { display:flex; gap:.6rem; margin-top:1rem; }
  .btn { display:inline-flex; align-items:center; justify-content:center; gap:.4rem; padding:.65rem 1rem; border-radius:8px; font-family:'Lexend',sans-serif; font-size:.75rem; letter-spacing:.04em; cursor:pointer; border:none; transition:all .2s; flex:1; }
  .btn-primary { background:var(--accent); color:var(--bg); font-weight:700; }
  .btn-primary:hover { background:#33eaff; }
  .btn-ghost { background:transparent; color:var(--muted); border:1px solid var(--border); }
  .btn-ghost:hover { color:var(--text); border-color:var(--muted); }
  /* ‚îÄ‚îÄ EV MODEL SEARCHABLE DROPDOWN ‚îÄ‚îÄ */
  .ev-search-wrap { position:relative; width:100%; margin-bottom:.8rem; }
  .ev-search-field {
    display:flex; align-items:center; gap:.6rem;
    background:var(--surface); border:2px solid var(--border); border-radius:10px;
    padding:.75rem 1rem; cursor:pointer; transition:border-color .2s;
    user-select:none;
  }
  .ev-search-field:hover { border-color:var(--muted); }
  .ev-search-wrap.open .ev-search-field { border-color:var(--accent); border-radius:10px 10px 0 0; }
  .ev-search-placeholder { font-family:'Lexend',sans-serif; font-size:.8rem; color:var(--muted); flex:1; text-align:left; }
  .ev-search-selected { font-family:'Lexend',sans-serif; font-size:.8rem; color:var(--text); flex:1; text-align:left; }
  .ev-search-wrap.open #ob-chevron,
  .ev-search-wrap.open #edit-chevron { transform:rotate(180deg); }

  .ev-dropdown {
    display:none; position:absolute; left:0; right:0; top:100%; z-index:200;
    background:var(--card); border:2px solid var(--accent); border-top:none;
    border-radius:0 0 10px 10px; overflow:hidden;
    box-shadow:0 12px 32px rgba(0,0,0,.4);
  }
  .ev-search-wrap.open .ev-dropdown { display:block; }
  .ev-dropdown-search {
    width:100%; background:var(--surface); border:none; border-bottom:1px solid var(--border);
    padding:.65rem 1rem; color:var(--text); font-family:'Lexend',sans-serif; font-size:.8rem;
    outline:none;
  }
  .ev-dropdown-search::placeholder { color:var(--muted); }
  .ev-dropdown-list { max-height:220px; overflow-y:auto; scrollbar-width:thin; scrollbar-color:var(--border) transparent; }
  .ev-dropdown-list::-webkit-scrollbar { width:4px; }
  .ev-dropdown-list::-webkit-scrollbar-track { background:transparent; }
  .ev-dropdown-list::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }
  .ev-option {
    display:flex; justify-content:space-between; align-items:center;
    padding:.65rem 1rem; cursor:pointer;
    border-bottom:1px solid rgba(30,58,95,.4);
    transition:background .12s;
  }
  .ev-option:last-child { border-bottom:none; }
  .ev-option:hover { background:rgba(0,229,255,.06); }
  .ev-option.selected { background:rgba(0,229,255,.1); }
  .ev-option-name { font-family:'Lexend',sans-serif; font-size:.78rem; color:var(--text); }
  .ev-option-kwh { font-family:'Zen Dots',sans-serif; font-size:.72rem; color:var(--accent); }
  .ev-option-none { font-family:'Lexend',sans-serif; font-size:.75rem; color:var(--muted); padding:1rem; text-align:center; }

  /* divider between dropdown and manual input */
  .ob-divider, .edit-divider {
    display:flex; align-items:center; gap:.6rem; margin:.8rem 0;
    font-family:'Lexend',sans-serif; font-size:.62rem; letter-spacing:.08em;
    text-transform:uppercase; color:var(--muted);
  }
  .ob-divider::before, .ob-divider::after,
  .edit-divider::before, .edit-divider::after { content:''; flex:1; height:1px; background:var(--border); }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ONBOARDING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="onboarding">

  <!-- Screen 1: Welcome -->
  <div class="ob-screen active" id="ob-welcome">
    <div class="ob-bolt-wrap">
      <svg width="40" height="40"><use href="#ico-bolt"/></svg>
    </div>
    <div class="ob-title">EV <span>Calc</span></div>
    <div class="ob-sub">Simple, instant EV charging calculations.<br>Let's get set up ‚Äî takes about 30 seconds.</div>
    <div class="ob-dots">
      <div class="ob-dot active"></div>
      <div class="ob-dot"></div>
      <div class="ob-dot"></div>
    </div>
    <button class="ob-btn ob-btn-primary" onclick="goToStep(1)">
      Get started
      <svg width="16" height="16"><use href="#ico-arrow-right"/></svg>
    </button>
  </div>

  <!-- Screen 2: Battery Capacity -->
  <div class="ob-screen" id="ob-battery">
    <div class="ob-dots">
      <div class="ob-dot done"></div>
      <div class="ob-dot active"></div>
      <div class="ob-dot"></div>
    </div>
    <div class="ob-step-label">Step 1 of 1 &nbsp;¬∑&nbsp; Battery Size</div>
    <div class="ob-question">What's your battery capacity?</div>
    <div class="ob-hint">Find this in your car's spec sheet ‚Äî it's usually listed in kWh. Pick your model below or type it in.</div>

    <div class="ev-search-wrap" id="ob-search-wrap">
      <div class="ev-search-field" onclick="toggleDropdown('ob')">
        <svg width="14" height="14" style="color:var(--muted);flex-shrink:0"><use href="#ico-search"/></svg>
        <span id="ob-search-display" class="ev-search-placeholder">Search your car model‚Ä¶</span>
        <svg width="12" height="12" style="color:var(--muted);flex-shrink:0;transition:transform .2s" id="ob-chevron"><use href="#ico-chevron"/></svg>
      </div>
      <div class="ev-dropdown" id="ob-dropdown">
        <input class="ev-dropdown-search" id="ob-dropdown-input" type="text" placeholder="Type to filter‚Ä¶" oninput="filterDropdown('ob')" autocomplete="off">
        <div class="ev-dropdown-list" id="ob-dropdown-list"></div>
      </div>
    </div>

    <div class="ob-divider"><span>or enter manually</span></div>

    <div class="ob-input-wrap">
      <input class="ob-input" type="number" id="ob-battery-input" placeholder="e.g. 77.4" step="0.1" oninput="onBatteryInput()" min="1" max="300">
      <span class="ob-input-unit">kWh</span>
    </div>

    <button class="ob-btn ob-btn-primary" id="ob-battery-next" onclick="goToStep(2)" disabled>
      Save &amp; continue
      <svg width="16" height="16"><use href="#ico-arrow-right"/></svg>
    </button>
  </div>

  <!-- Screen 3: All set -->
  <div class="ob-screen" id="ob-ready">
    <div class="ob-dots">
      <div class="ob-dot done"></div>
      <div class="ob-dot done"></div>
      <div class="ob-dot active"></div>
    </div>
    <div class="ob-ready-icon">
      <svg width="36" height="36"><use href="#ico-sparkle"/></svg>
    </div>
    <div class="ob-question">You're all set!</div>
    <div class="ob-hint" id="ob-ready-text">Your battery capacity is saved. You can update it any time from the calculator.</div>

    <div class="ob-summary-card">
      <div class="ob-summary-label">Your setup</div>
      <div class="ob-summary-row">
        <span class="ob-summary-key">
          <svg width="16" height="16" style="color:var(--muted)"><use href="#ico-battery"/></svg>
          Battery capacity
        </span>
        <span class="ob-summary-val" id="ob-confirm-kwh">‚Äî</span>
      </div>
    </div>

    <button class="ob-btn ob-btn-primary" onclick="launchApp()">
      <svg width="16" height="16"><use href="#ico-bolt"/></svg>
      Open Calculator
    </button>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MAIN APP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="app">

<header>
  <div class="header-inner">
    <div class="logo">
      <div class="logo-icon">
        <svg width="18" height="18"><use href="#ico-bolt"/></svg>
      </div>
      <div class="logo-text">EV <span>Calc</span></div>
    </div>
    <div class="header-car" onclick="openEditModal()" title="Update battery capacity">
      <svg width="15" height="15" style="color:var(--accent)"><use href="#ico-battery"/></svg>
      <span class="cap" id="header-cap">‚Äî</span>
      <span style="font-family:'Lexend',sans-serif;font-size:.65rem;">kWh</span>
      <div class="header-sep"></div>
      <svg width="13" height="13"><use href="#ico-edit"/></svg>
    </div>
  </div>
</header>

<nav>
  <div class="nav-inner">
    <div class="tab active" onclick="showPage('charge-time', this)">
      <svg width="14" height="14"><use href="#ico-clock"/></svg>
      Charge Time
    </div>
    <div class="tab" onclick="showPage('charge-gain', this)">
      <svg width="14" height="14"><use href="#ico-trending"/></svg>
      Charge Gain
    </div>
  </div>
</nav>

<main>

  <!-- ‚ïê‚ïê PAGE 1: HOW LONG TO CHARGE ‚ïê‚ïê -->
  <div class="page active" id="page-charge-time">
    <div class="section-header" style="margin-top:0;">
      <span class="section-title">How long will charging take?</span>
    </div>

    <div class="calc-card">
      <div class="form-group">
        <label class="form-label">Charger Power</label>
        <div class="charger-chips" id="chips-time">
          <button class="charger-chip" data-kw="3"   onclick="selectChip(this,'time')">3 kW</button>
          <button class="charger-chip" data-kw="3.7" onclick="selectChip(this,'time')">3.7 kW</button>
          <button class="charger-chip" data-kw="7"   onclick="selectChip(this,'time')">7 kW</button>
          <button class="charger-chip" data-kw="11"  onclick="selectChip(this,'time')">11 kW</button>
          <button class="charger-chip" data-kw="22"  onclick="selectChip(this,'time')">22 kW</button>
          <button class="charger-chip" data-kw="50"  onclick="selectChip(this,'time')">50 kW</button>
          <button class="charger-chip" data-kw="100" onclick="selectChip(this,'time')">100 kW</button>
          <button class="charger-chip" data-kw="150" onclick="selectChip(this,'time')">150 kW</button>
          <button class="charger-chip" data-kw="350" onclick="selectChip(this,'time')">350 kW</button>
          <button class="charger-chip active" data-kw="custom" onclick="selectChip(this,'time')">Custom</button>
        </div>
        <input class="form-input" type="number" id="t-power" placeholder="Enter kW" step="0.1" oninput="calcChargeTime()">
      </div>

      <div class="form-group">
        <label class="form-label">Battery ‚Äî Current ‚Üí Target</label>
        <div class="slider-vals">
          <div class="slider-val">
            <div class="lbl">Current</div>
            <div class="num cyan" id="t-current-display">20%</div>
          </div>
          <div class="slider-val" style="text-align:right;">
            <div class="lbl">Target</div>
            <div class="num purple" id="t-target-display">80%</div>
          </div>
        </div>
        <div class="battery-vis">
          <div class="battery-target" id="bvis-target"></div>
          <div class="battery-current" id="bvis-current"></div>
        </div>
        <div class="dual-range">
          <div class="range-track"><div class="range-fill" id="range-fill-time"></div></div>
          <input type="range" id="range-current" min="0" max="100" value="20" oninput="onSlider()">
          <input type="range" id="range-target"  min="0" max="100" value="80" oninput="onSlider()">
        </div>
        <div class="range-labels"><span>0%</span><span>25%</span><span>50%</span><span>75%</span><span>100%</span></div>
      </div>
    </div>

    <div class="result-hero">
      <div class="big-val" id="time-result-main">‚Äî</div>
      <div class="sub-val" id="time-result-sub">Select a charger power above to calculate</div>
      <div class="breakdown" id="time-result-breakdown"></div>
    </div>

    <div class="tip">
      <span class="tip-icon"><svg width="16" height="16"><use href="#ico-tip"/></svg></span>
      <span><strong>Tip:</strong> Most manufacturers recommend charging to <strong>80%</strong> for day-to-day use to preserve long-term battery health. Only charge to 100% before long trips.</span>
    </div>

    <div class="calc-card">
      <div class="section-header" style="margin-top:0;"><span class="section-title">Details</span></div>
      <div class="info-row"><span class="lbl">Energy needed</span><span class="val" id="t-kwh-needed">‚Äî</span></div>
      <div class="info-row"><span class="lbl">Charger power</span><span class="val" id="t-kw-display">‚Äî</span></div>
      <div class="info-row"><span class="lbl">% to add</span><span class="val" id="t-pct-add">‚Äî</span></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê PAGE 2: HOW MUCH WILL I GAIN ‚ïê‚ïê -->
  <div class="page" id="page-charge-gain">
    <div class="section-header" style="margin-top:0;">
      <span class="section-title">How much will I gain?</span>
    </div>

    <div class="calc-card green">
      <div class="form-group">
        <label class="form-label">Charger Power</label>
        <div class="charger-chips" id="chips-gain">
          <button class="charger-chip" data-kw="3"   onclick="selectChip(this,'gain')">3 kW</button>
          <button class="charger-chip" data-kw="3.7" onclick="selectChip(this,'gain')">3.7 kW</button>
          <button class="charger-chip" data-kw="7"   onclick="selectChip(this,'gain')">7 kW</button>
          <button class="charger-chip" data-kw="11"  onclick="selectChip(this,'gain')">11 kW</button>
          <button class="charger-chip" data-kw="22"  onclick="selectChip(this,'gain')">22 kW</button>
          <button class="charger-chip" data-kw="50"  onclick="selectChip(this,'gain')">50 kW</button>
          <button class="charger-chip" data-kw="100" onclick="selectChip(this,'gain')">100 kW</button>
          <button class="charger-chip" data-kw="150" onclick="selectChip(this,'gain')">150 kW</button>
          <button class="charger-chip" data-kw="350" onclick="selectChip(this,'gain')">350 kW</button>
          <button class="charger-chip active" data-kw="custom" onclick="selectChip(this,'gain')">Custom</button>
        </div>
        <input class="form-input" type="number" id="g-power" placeholder="Enter kW" step="0.1" oninput="calcChargeGain()">
      </div>

      <div class="form-group">
        <label class="form-label">Charging Duration</label>
        <div class="input-row">
          <div>
            <input class="form-input" type="number" id="g-hours" min="0" placeholder="0" oninput="calcChargeGain()">
            <div style="font-family:'Lexend',sans-serif;font-size:.58rem;color:var(--muted);margin-top:.25rem;padding-left:.2rem;letter-spacing:.06em;">HOURS</div>
          </div>
          <div>
            <input class="form-input" type="number" id="g-minutes" min="0" max="59" placeholder="0" oninput="calcChargeGain()">
            <div style="font-family:'Lexend',sans-serif;font-size:.58rem;color:var(--muted);margin-top:.25rem;padding-left:.2rem;letter-spacing:.06em;">MINUTES</div>
          </div>
        </div>
      </div>
    </div>

    <div class="result-hero green">
      <div class="big-val" id="gain-result-main">‚Äî</div>
      <div class="sub-val" id="gain-result-sub">Select charger power and enter duration above</div>
      <div class="breakdown" id="gain-result-breakdown"></div>
    </div>

    <div class="tip">
      <span class="tip-icon"><svg width="16" height="16"><use href="#ico-tip"/></svg></span>
      <span><strong>Tip:</strong> DC rapid chargers (50 kW+) often slow down above 80% to protect battery cells ‚Äî your last 20% takes longer than the first 80%.</span>
    </div>

    <div class="calc-card green">
      <div class="section-header" style="margin-top:0;"><span class="section-title">Details</span></div>
      <div class="info-row"><span class="lbl">Energy delivered</span><span class="val" id="g-kwh-delivered">‚Äî</span></div>
      <div class="info-row"><span class="lbl">Charger power</span><span class="val" id="g-kw-display">‚Äî</span></div>
      <div class="info-row"><span class="lbl">Duration</span><span class="val" id="g-duration-display">‚Äî</span></div>
    </div>
  </div>

</main>
</div><!-- /#app -->

<!-- Edit Battery Modal -->
<div id="edit-modal">
  <div class="edit-modal-card">
    <div class="edit-modal-title">
      <svg width="18" height="18"><use href="#ico-battery"/></svg>
      Update Battery Capacity
    </div>
    <p>Change your saved battery size. Pick a model or enter a custom value.</p>
    <div class="ev-search-wrap" id="edit-search-wrap">
      <div class="ev-search-field" onclick="toggleDropdown('edit')">
        <svg width="14" height="14" style="color:var(--muted);flex-shrink:0"><use href="#ico-search"/></svg>
        <span id="edit-search-display" class="ev-search-placeholder">Search your car model‚Ä¶</span>
        <svg width="12" height="12" style="color:var(--muted);flex-shrink:0;transition:transform .2s" id="edit-chevron"><use href="#ico-chevron"/></svg>
      </div>
      <div class="ev-dropdown" id="edit-dropdown">
        <input class="ev-dropdown-search" id="edit-dropdown-input" type="text" placeholder="Type to filter‚Ä¶" oninput="filterDropdown('edit')" autocomplete="off">
        <div class="ev-dropdown-list" id="edit-dropdown-list"></div>
      </div>
    </div>
    <div class="edit-divider"><span>or enter manually</span></div>
    <div class="form-group">
      <label class="form-label">Custom (kWh)</label>
      <input class="form-input" type="number" id="edit-cap-input" step="0.1" placeholder="e.g. 77.4" oninput="clearEditChips()">
    </div>
    <div class="edit-modal-actions">
      <button class="btn btn-ghost" onclick="closeEditModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveEditModal()">
        <svg width="14" height="14"><use href="#ico-check"/></svg>
        Save
      </button>
    </div>
  </div>
</div>

<div class="toast" id="toast">
  <svg width="13" height="13" id="toast-icon"><use href="#ico-check"/></svg>
  <span id="toast-msg"></span>
</div>

<script>
// ‚ïê‚ïê STATE ‚ïê‚ïê
let savedBattery = parseFloat(localStorage.getItem('ev-calc-battery')) || null;

// ‚ïê‚ïê EV MODEL DATABASE ‚ïê‚ïê
const EV_MODELS = [
  // Audi
  { name:'Audi e-tron 50',            kwh:71.2 },
  { name:'Audi e-tron 55',            kwh:95 },
  { name:'Audi e-tron GT',            kwh:93.4 },
  { name:'Audi Q4 e-tron 40',         kwh:76.6 },
  { name:'Audi Q4 e-tron 45',         kwh:76.6 },
  { name:'Audi Q4 e-tron 50',         kwh:76.6 },
  { name:'Audi Q8 e-tron 50',         kwh:95 },
  { name:'Audi Q8 e-tron 55',         kwh:114 },
  // BMW
  { name:'BMW i3 (42 kWh)',           kwh:42.2 },
  { name:'BMW i3 (120 Ah)',           kwh:42.2 },
  { name:'BMW i4 eDrive35',           kwh:70.2 },
  { name:'BMW i4 eDrive40',           kwh:83.9 },
  { name:'BMW i4 M50',                kwh:83.9 },
  { name:'BMW i5 eDrive40',           kwh:84.3 },
  { name:'BMW i5 M60',                kwh:84.3 },
  { name:'BMW i7 eDrive50',           kwh:105.7 },
  { name:'BMW i7 xDrive60',           kwh:105.7 },
  { name:'BMW iX xDrive40',           kwh:76.6 },
  { name:'BMW iX xDrive50',           kwh:111.5 },
  { name:'BMW iX M60',                kwh:111.5 },
  { name:'BMW iX1 xDrive30',          kwh:64.7 },
  { name:'BMW iX2 eDrive20',          kwh:64.7 },
  { name:'BMW iX3',                   kwh:80 },
  // BYD
  { name:'BYD Atto 3 (49 kWh)',       kwh:49.92 },
  { name:'BYD Atto 3 (60 kWh)',       kwh:60.48 },
  { name:'BYD Dolphin Standard',      kwh:44.9 },
  { name:'BYD Dolphin Extended',      kwh:60.4 },
  { name:'BYD Han EV',                kwh:85.4 },
  { name:'BYD Seal Standard',         kwh:61.4 },
  { name:'BYD Seal AWD',              kwh:82.5 },
  { name:'BYD Seal U (Tang)',         kwh:87.3 },
  { name:'BYD Seagull',               kwh:38.8 },
  { name:'BYD Sealion 6 DM-i',       kwh:15.8 },
  // Cupra
  { name:'Cupra Born 58 kWh',         kwh:58 },
  { name:'Cupra Born 77 kWh',         kwh:77 },
  { name:'Cupra Tavascan',            kwh:77 },
  // Ford
  { name:'Ford Mustang Mach-E SR RWD',kwh:70 },
  { name:'Ford Mustang Mach-E ER RWD',kwh:91 },
  { name:'Ford Mustang Mach-E ER AWD',kwh:91 },
  { name:'Ford Explorer RWD',         kwh:77 },
  { name:'Ford Explorer AWD',         kwh:77 },
  { name:'Ford Puma Gen-E',           kwh:43 },
  // Hyundai
  { name:'Hyundai Ioniq 5 SR',        kwh:58 },
  { name:'Hyundai Ioniq 5 LR RWD',    kwh:77.4 },
  { name:'Hyundai Ioniq 5 LR AWD',    kwh:77.4 },
  { name:'Hyundai Ioniq 5 N',         kwh:84 },
  { name:'Hyundai Ioniq 6 SR RWD',    kwh:53 },
  { name:'Hyundai Ioniq 6 LR RWD',    kwh:77.4 },
  { name:'Hyundai Ioniq 6 LR AWD',    kwh:77.4 },
  { name:'Hyundai Kona Electric 39',  kwh:39.2 },
  { name:'Hyundai Kona Electric 65',  kwh:65.4 },
  // Jaguar
  { name:'Jaguar I-Pace',             kwh:90 },
  // Kia
  { name:'Kia EV3 Standard',          kwh:58.3 },
  { name:'Kia EV3 Long Range',        kwh:81.4 },
  { name:'Kia EV6 SR',                kwh:58 },
  { name:'Kia EV6 LR RWD',           kwh:77.4 },
  { name:'Kia EV6 LR AWD',           kwh:77.4 },
  { name:'Kia EV6 GT',                kwh:77.4 },
  { name:'Kia EV9 RWD SR',            kwh:76.1 },
  { name:'Kia EV9 RWD LR',           kwh:99.8 },
  { name:'Kia EV9 AWD LR',           kwh:99.8 },
  { name:'Kia Niro EV',               kwh:64.8 },
  // Leapmotor
  { name:'Leapmotor T03',             kwh:41 },
  // Lotus
  { name:'Lotus Eletre S',            kwh:112 },
  // Lucid
  { name:'Lucid Air Pure',            kwh:88 },
  { name:'Lucid Air Grand Touring',   kwh:118 },
  { name:'Lucid Air Sapphire',        kwh:118 },
  // Mercedes
  { name:'Mercedes EQA 250',          kwh:66.5 },
  { name:'Mercedes EQA 350 AWD',      kwh:66.5 },
  { name:'Mercedes EQB 250',          kwh:66.5 },
  { name:'Mercedes EQC 400',          kwh:80 },
  { name:'Mercedes EQE 300',          kwh:90.6 },
  { name:'Mercedes EQE 350',          kwh:90.6 },
  { name:'Mercedes EQE 500 AWD',      kwh:90.6 },
  { name:'Mercedes EQE SUV 350',      kwh:90.6 },
  { name:'Mercedes EQS 450+',         kwh:107.8 },
  { name:'Mercedes EQS 580 4MATIC',   kwh:107.8 },
  { name:'Mercedes EQS SUV 450+',     kwh:107.8 },
  { name:'Mercedes EQV 300',          kwh:90 },
  { name:'Mercedes G 580 EQ',         kwh:116 },
  // MG
  { name:'MG 4 Standard',             kwh:51 },
  { name:'MG 4 Long Range',           kwh:64 },
  { name:'MG 4 XPower',               kwh:64 },
  { name:'MG 5 Standard Range',       kwh:50.3 },
  { name:'MG 5 Long Range',           kwh:61.1 },
  { name:'MG ZS EV Standard',         kwh:51 },
  { name:'MG ZS EV Long Range',       kwh:72.6 },
  { name:'MG Cyberster',              kwh:77 },
  // Mini
  { name:'Mini Electric (3dr)',        kwh:32.6 },
  { name:'Mini Countryman E',         kwh:64.7 },
  { name:'Mini Countryman SE ALL4',   kwh:64.7 },
  // Nissan
  { name:'Nissan Ariya 63 kWh',       kwh:63 },
  { name:'Nissan Ariya 87 kWh',       kwh:87 },
  { name:'Nissan Ariya e-4ORCE 63',   kwh:63 },
  { name:'Nissan Ariya e-4ORCE 87',   kwh:87 },
  { name:'Nissan Leaf 40 kWh',        kwh:40 },
  { name:'Nissan Leaf 62 kWh (e+)',   kwh:62 },
  // Peugeot
  { name:'Peugeot e-208 50 kWh',      kwh:50 },
  { name:'Peugeot e-2008 50 kWh',     kwh:50 },
  { name:'Peugeot E-3008 73 kWh',     kwh:73 },
  { name:'Peugeot E-3008 98 kWh',     kwh:98 },
  // Polestar
  { name:'Polestar 2 SR',             kwh:69 },
  { name:'Polestar 2 LR Single',      kwh:82 },
  { name:'Polestar 2 LR Dual',        kwh:82 },
  { name:'Polestar 3 LR AWD',         kwh:111 },
  { name:'Polestar 4 LR AWD',         kwh:100 },
  // Renault
  { name:'Renault Megane E-Tech 40',  kwh:40 },
  { name:'Renault Megane E-Tech 60',  kwh:60 },
  { name:'Renault Scenic E-Tech 60',  kwh:60 },
  { name:'Renault Scenic E-Tech 87',  kwh:87 },
  { name:'Renault Twingo E-Tech',     kwh:22 },
  { name:'Renault Zoe 52 kWh',        kwh:52 },
  // Rivian
  { name:'Rivian R1T Dual Motor',     kwh:135 },
  { name:'Rivian R1T Quad Motor',     kwh:135 },
  { name:'Rivian R1S Dual Motor',     kwh:135 },
  // Skoda
  { name:'Skoda Enyaq iV 60',         kwh:62 },
  { name:'Skoda Enyaq iV 85',         kwh:82 },
  { name:'Skoda Enyaq Coupe 85',      kwh:82 },
  { name:'Skoda Elroq 50',            kwh:55 },
  { name:'Skoda Elroq 85',            kwh:82 },
  // Smart
  { name:'Smart #1 Pro',              kwh:49 },
  { name:'Smart #1 Premium',          kwh:66 },
  { name:'Smart #3 Pro',              kwh:49 },
  { name:'Smart #3 Brabus',           kwh:66 },
  // Tesla
  { name:'Tesla Model 3 SR+',         kwh:57.5 },
  { name:'Tesla Model 3 LR AWD',      kwh:75 },
  { name:'Tesla Model 3 Performance', kwh:75 },
  { name:'Tesla Model 3 Highland SR', kwh:60 },
  { name:'Tesla Model 3 Highland LR', kwh:75 },
  { name:'Tesla Model S LR',          kwh:100 },
  { name:'Tesla Model S Plaid',       kwh:100 },
  { name:'Tesla Model X LR',          kwh:100 },
  { name:'Tesla Model X Plaid',       kwh:100 },
  { name:'Tesla Model Y SR',          kwh:57.5 },
  { name:'Tesla Model Y LR AWD',      kwh:75 },
  { name:'Tesla Model Y Performance', kwh:75 },
  { name:'Tesla Cybertruck AWD',      kwh:123 },
  { name:'Tesla Cybertruck CyberBeast',kwh:123 },
  // Vauxhall / Opel
  { name:'Vauxhall Mokka-e',          kwh:50 },
  { name:'Vauxhall Corsa-e',          kwh:50 },
  { name:'Vauxhall Astra-e',          kwh:54 },
  { name:'Vauxhall Grandland Electric',kwh:73 },
  // Volkswagen
  { name:'VW ID.2 (upcoming)',        kwh:38 },
  { name:'VW ID.3 Pure',              kwh:58 },
  { name:'VW ID.3 Pro',               kwh:58 },
  { name:'VW ID.3 Pro S',             kwh:77 },
  { name:'VW ID.4 Pure',              kwh:52 },
  { name:'VW ID.4 Pro',               kwh:77 },
  { name:'VW ID.4 GTX',              kwh:77 },
  { name:'VW ID.5 Pro',               kwh:77 },
  { name:'VW ID.5 GTX',              kwh:77 },
  { name:'VW ID.7 Pro',               kwh:77 },
  { name:'VW ID.7 Tourer',            kwh:86 },
  { name:'VW ID. Buzz SR',            kwh:77 },
  { name:'VW ID. Buzz LR',            kwh:86 },
  // Volvo
  { name:'Volvo EX30 SR',             kwh:51 },
  { name:'Volvo EX30 ER AWD',         kwh:69 },
  { name:'Volvo EX40 SR',             kwh:69 },
  { name:'Volvo EX40 Twin',           kwh:69 },
  { name:'Volvo EC40 SR',             kwh:69 },
  { name:'Volvo EC40 Twin',           kwh:69 },
  { name:'Volvo EX90 Twin Motor',     kwh:111 },
  { name:'Volvo EX90 Performance',    kwh:111 },
  // Xpeng
  { name:'Xpeng G6 RWD SR',          kwh:66 },
  { name:'Xpeng G6 RWD LR',          kwh:87.5 },
  { name:'Xpeng G9 RWD LR',          kwh:98 },
  { name:'Xpeng P7',                  kwh:80.9 },
].sort((a,b) => a.name.localeCompare(b.name));

// ‚ïê‚ïê DROPDOWN STATE ‚ïê‚ïê
let activeDropdown = null;

function buildDropdownList(prefix, filter = '') {
  const list = document.getElementById(`${prefix}-dropdown-list`);
  const lower = filter.toLowerCase();
  const matches = EV_MODELS.filter(m => !filter || m.name.toLowerCase().includes(lower));
  if (matches.length === 0) {
    list.innerHTML = `<div class="ev-option-none">No models found ‚Äî enter kWh manually below</div>`;
    return;
  }
  list.innerHTML = matches.map(m => `
    <div class="ev-option" onclick="selectEVModel('${prefix}', '${m.name.replace(/'/g,"\\'")}', ${m.kwh})">
      <span class="ev-option-name">${m.name}</span>
      <span class="ev-option-kwh">${m.kwh} kWh</span>
    </div>
  `).join('');
}

function toggleDropdown(prefix) {
  const wrap = document.getElementById(`${prefix}-search-wrap`);
  const isOpen = wrap.classList.contains('open');
  // Close any open dropdown first
  if (activeDropdown && activeDropdown !== prefix) {
    document.getElementById(`${activeDropdown}-search-wrap`).classList.remove('open');
  }
  if (isOpen) {
    wrap.classList.remove('open');
    activeDropdown = null;
  } else {
    wrap.classList.add('open');
    activeDropdown = prefix;
    buildDropdownList(prefix);
    setTimeout(() => document.getElementById(`${prefix}-dropdown-input`).focus(), 50);
  }
}

function filterDropdown(prefix) {
  const val = document.getElementById(`${prefix}-dropdown-input`).value;
  buildDropdownList(prefix, val);
}

function selectEVModel(prefix, name, kwh) {
  // Update display
  const display = document.getElementById(`${prefix}-search-display`);
  display.textContent = `${name} ‚Äî ${kwh} kWh`;
  display.className = 'ev-search-selected';
  // Close dropdown
  document.getElementById(`${prefix}-search-wrap`).classList.remove('open');
  document.getElementById(`${prefix}-dropdown-input`).value = '';
  activeDropdown = null;
  // Push value into the right input and trigger update
  if (prefix === 'ob') {
    document.getElementById('ob-battery-input').value = kwh;
    document.getElementById('ob-battery-next').disabled = false;
  } else {
    document.getElementById('edit-cap-input').value = kwh;
  }
}

// Close dropdown when clicking outside
document.addEventListener('click', e => {
  if (activeDropdown && !e.target.closest('.ev-search-wrap')) {
    document.getElementById(`${activeDropdown}-search-wrap`).classList.remove('open');
    activeDropdown = null;
  }
});

// ‚ïê‚ïê ONBOARDING ‚ïê‚ïê
window.addEventListener('load', () => {
  if (savedBattery) {
    document.getElementById('ob-welcome').classList.remove('active');
    document.getElementById('ob-ready').classList.add('active');
    document.getElementById('ob-confirm-kwh').textContent = savedBattery + ' kWh';
    document.getElementById('ob-ready-text').textContent = `Welcome back! Your ${savedBattery} kWh battery is saved and ready to go.`;
  }
});

function goToStep(step) {
  if (step === 1) {
    document.getElementById('ob-welcome').classList.remove('active');
    document.getElementById('ob-battery').classList.add('active');
    if (savedBattery) {
      document.getElementById('ob-battery-input').value = savedBattery;
      document.getElementById('ob-battery-next').disabled = false;
    }
  } else if (step === 2) {
    const val = parseFloat(document.getElementById('ob-battery-input').value);
    if (!val || val <= 0) return;
    savedBattery = val;
    localStorage.setItem('ev-calc-battery', val);
    document.getElementById('ob-confirm-kwh').textContent = val + ' kWh';
    document.getElementById('ob-battery').classList.remove('active');
    document.getElementById('ob-ready').classList.add('active');
  }
}

function onBatteryInput() {
  const val = parseFloat(document.getElementById('ob-battery-input').value);
  document.getElementById('ob-battery-next').disabled = !(val > 0);
  // Clear the dropdown display if manually typing
  const display = document.getElementById('ob-search-display');
  display.textContent = 'Search your car model‚Ä¶';
  display.className = 'ev-search-placeholder';
}

function skipSetup() {
  document.getElementById('ob-battery').classList.remove('active');
  document.getElementById('ob-ready').classList.add('active');
  document.getElementById('ob-confirm-kwh').textContent = 'Not set';
  document.getElementById('ob-ready-text').textContent = 'No problem ‚Äî you can set your battery size any time using the edit button in the top corner of the calculator.';
}

function launchApp() {
  const ob = document.getElementById('onboarding');
  ob.classList.add('hidden');
  setTimeout(() => ob.style.display = 'none', 400);
  document.getElementById('app').classList.add('visible');
  initApp();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  APP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initApp() {
  updateHeaderCap();
  onSlider();
  calcChargeTime();
  calcChargeGain();
}

function updateHeaderCap() {
  document.getElementById('header-cap').textContent = savedBattery || '?';
}

function showPage(id, tabEl) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
  tabEl.classList.add('active');
}

// ‚ïê‚ïê EDIT MODAL ‚ïê‚ïê
function openEditModal() {
  document.getElementById('edit-cap-input').value = savedBattery || '';
  // Reset search display
  const display = document.getElementById('edit-search-display');
  display.textContent = 'Search your car model‚Ä¶';
  display.className = 'ev-search-placeholder';
  document.getElementById('edit-modal').classList.add('open');
}
function closeEditModal() {
  document.getElementById('edit-modal').classList.remove('open');
}
function saveEditModal() {
  const val = parseFloat(document.getElementById('edit-cap-input').value);
  if (!val || val <= 0) { showToast('Enter a valid capacity', true); return; }
  savedBattery = val;
  localStorage.setItem('ev-calc-battery', val);
  // Reset dropdown
  const display = document.getElementById('edit-search-display');
  display.textContent = 'Search your car model‚Ä¶';
  display.className = 'ev-search-placeholder';
  closeEditModal();
  updateHeaderCap();
  calcChargeTime();
  calcChargeGain();
  showToast('Battery updated to ' + val + ' kWh');
}
document.getElementById('edit-modal').addEventListener('click', e => {
  if (e.target === document.getElementById('edit-modal')) closeEditModal();
});

// ‚ïê‚ïê CHARGER CHIPS ‚ïê‚ïê
function selectChip(el, page) {
  const kw = el.dataset.kw;
  document.querySelectorAll(`#chips-${page} .charger-chip`).forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  const input = document.getElementById(page === 'time' ? 't-power' : 'g-power');
  if (kw === 'custom') { input.value = ''; input.focus(); }
  else input.value = kw;
  if (page === 'time') calcChargeTime(); else calcChargeGain();
}

// ‚ïê‚ïê DUAL SLIDER ‚ïê‚ïê
function onSlider() {
  let cur = parseInt(document.getElementById('range-current').value);
  let tgt = parseInt(document.getElementById('range-target').value);
  if (tgt <= cur) { document.getElementById('range-target').value = cur + 1; tgt = cur + 1; }
  document.getElementById('t-current-display').textContent = cur + '%';
  document.getElementById('t-target-display').textContent = tgt + '%';
  document.getElementById('bvis-current').style.width = cur + '%';
  document.getElementById('bvis-target').style.width = tgt + '%';
  const fill = document.getElementById('range-fill-time');
  fill.style.left = cur + '%';
  fill.style.width = (tgt - cur) + '%';
  calcChargeTime();
}

// ‚ïê‚ïê CALC 1: CHARGE TIME ‚ïê‚ïê
function calcChargeTime() {
  const capacity = savedBattery;
  const power = parseFloat(document.getElementById('t-power').value);
  const curPct = parseInt(document.getElementById('range-current').value);
  const tgtPct = parseInt(document.getElementById('range-target').value);
  const pctAdd = tgtPct - curPct;
  document.getElementById('t-pct-add').textContent = pctAdd + '%';

  if (!capacity) {
    setTimeResult(null, 'Tap the battery icon above to set your capacity');
    document.getElementById('t-kwh-needed').textContent = '‚Äî';
    document.getElementById('t-kw-display').textContent = '‚Äî';
    return;
  }
  const kwhNeeded = (pctAdd / 100) * capacity;
  document.getElementById('t-kwh-needed').textContent = kwhNeeded.toFixed(1) + ' kWh';

  if (!power || power <= 0) {
    setTimeResult(null, 'Select or enter charger power above');
    document.getElementById('t-kw-display').textContent = '‚Äî';
    return;
  }
  document.getElementById('t-kw-display').textContent = power + ' kW';
  setTimeResult(kwhNeeded / power, `To charge from ${curPct}% to ${tgtPct}%`);
}

function setTimeResult(hours, sub) {
  const main = document.getElementById('time-result-main');
  const subEl = document.getElementById('time-result-sub');
  const bd = document.getElementById('time-result-breakdown');
  subEl.textContent = sub;
  if (hours === null) { main.textContent = '‚Äî'; bd.innerHTML = ''; return; }
  const h = Math.floor(hours);
  const m = Math.round((hours - h) * 60);
  main.textContent = h > 0 ? `${h}h ${m}m` : `${m} min`;
  bd.innerHTML = `
    <div class="breakdown-item"><div class="val">${h}h</div><div class="lbl">Hours</div></div>
    <div class="breakdown-item"><div class="val">${m}m</div><div class="lbl">Minutes</div></div>
    <div class="breakdown-item"><div class="val">${Math.round(hours * 60)}</div><div class="lbl">Total mins</div></div>
  `;
}

// ‚ïê‚ïê CALC 2: CHARGE GAIN ‚ïê‚ïê
function calcChargeGain() {
  const capacity = savedBattery;
  const power = parseFloat(document.getElementById('g-power').value);
  const hrs = parseFloat(document.getElementById('g-hours').value) || 0;
  const mins = parseFloat(document.getElementById('g-minutes').value) || 0;
  const totalHours = hrs + (mins / 60);
  const durStr = hrs > 0 && mins > 0 ? `${hrs}h ${mins}m` : hrs > 0 ? `${hrs}h` : mins > 0 ? `${mins}m` : '‚Äî';
  document.getElementById('g-duration-display').textContent = durStr;

  if (!power || power <= 0) {
    setGainResult(null, 'Select or enter charger power above');
    document.getElementById('g-kwh-delivered').textContent = '‚Äî';
    document.getElementById('g-kw-display').textContent = '‚Äî';
    return;
  }
  document.getElementById('g-kw-display').textContent = power + ' kW';

  if (totalHours <= 0) {
    setGainResult(null, 'Enter how long you will be charging');
    document.getElementById('g-kwh-delivered').textContent = '‚Äî';
    return;
  }

  const kwhDelivered = power * totalHours;
  document.getElementById('g-kwh-delivered').textContent = kwhDelivered.toFixed(2) + ' kWh';

  if (!capacity) {
    setGainResult(null, 'Tap the battery icon above to set your capacity');
    return;
  }
  const pctGained = Math.min((kwhDelivered / capacity) * 100, 100);
  setGainResult(pctGained, `From ${durStr} at ${power} kW`, kwhDelivered);
}

function setGainResult(pct, sub, kwh) {
  const main = document.getElementById('gain-result-main');
  const subEl = document.getElementById('gain-result-sub');
  const bd = document.getElementById('gain-result-breakdown');
  subEl.textContent = sub;
  if (pct === null) { main.textContent = '‚Äî'; bd.innerHTML = ''; return; }
  main.textContent = pct.toFixed(1) + '%';
  if (kwh) {
    bd.innerHTML = `
      <div class="breakdown-item"><div class="val">${kwh.toFixed(1)}</div><div class="lbl">kWh added</div></div>
      <div class="breakdown-item"><div class="val">${pct.toFixed(1)}%</div><div class="lbl">% gained</div></div>
    `;
  }
}

// ‚ïê‚ïê TOAST ‚ïê‚ïê
function showToast(msg, error = false) {
  const t = document.getElementById('toast');
  const icon = document.getElementById('toast-icon');
  document.getElementById('toast-msg').textContent = msg;
  t.style.background = error ? 'var(--accent3)' : 'var(--accent)';
  t.style.color = 'var(--bg)';
  icon.style.display = error ? 'none' : 'block';
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2400);
}
// ‚ïê‚ïê SERVICE WORKER ‚ïê‚ïê
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
      .then(() => console.log('SW registered'))
      .catch(err => console.warn('SW failed:', err));
  });
}
</script>
</body>
</html>
